<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>C-DIS Gateway</title>
</head>
<body>
<h1>C-DIS Test Client</h1>

<div id="connection-status" style="width:200px; box-sizing: border-box">Disconnected</div>
<button id="connect-ws-btn" type="button">Connect WebSocket</button>
<input id="rest-url" style="display:block; width:600px; box-sizing: border-box" type="text"
       placeholder="REST API endpoint">
<button id="rest-get" type="button">GET request</button>
<button id="rest-post" type="button">POST request</button>
<textarea id="console" style="display:block; width:600px; height:400px; box-sizing: border-box" cols="30"
          rows="10"></textarea>
<input id="input-ws-txt" style="display:block; width:600px; box-sizing: border-box" type="text"
       placeholder="Send data (JSON) over websocket...">

<script>
    const connection_status_label = document.querySelector("#connection-status");
    const connect_ws_btn = document.querySelector("#connect-ws-btn");
    const get_request_btn = document.querySelector("#rest-get");
    const post_request_btn = document.querySelector("#post-get");
    const rest_url_txt = document.getElementById("rest-url");
    const console_area = document.querySelector("#console");
    const input_ws_txt = document.querySelector("#input-ws-txt");

    console.log(rest_url_txt);

    connect_ws_btn.addEventListener("click", function (e) {
        this.disabled = true;

        const websocket = new WebSocket("ws://localhost:8080/ws_connect");

        websocket.onopen = function () {
            console.log("connection opened");
            connection_status_label.innerHTML = "Connected";
            // websocket.send(username.value);
        }

        const btn = this;

        websocket.onclose = function () {
            console.log("connection closed");
            connection_status_label.innerHTML = "Disconnected";
            btn.disabled = false;
        }

        websocket.onmessage = function (e) {
            const message_json = JSON.parse(e.data);
            console.log("received message: " + message_json);
            console_area.value += e.data + "\r\n";
        }

        input_ws_txt.onkeydown = function (e) {
            if (e.key == "Enter") {
                websocket.send(input_ws_txt.value);
                input_ws_txt.value = "";
            }
        }
    });

    get_request_btn.addEventListener("click", function (e) {
        const url = rest_url_txt.value;
        console.log(url);
        rest_url_txt.value = "";
        const action = async () => {
            const full_url = "http://localhost:8080/"+url;
            console.log(full_url);
            const response_future = await fetch(full_url);
            const response_json = await response_future.json(); //extract JSON from the http response
            // do something with the received JSON
            console.log(response_json);
        };
        action();
    })
</script>
</body>
</html>